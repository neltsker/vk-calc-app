!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).vkConnectPromise=t()}(this,function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t,n=(function(e,t){function i(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}function n(e,t){var n=t||{bubbles:!1,cancelable:!1,detail:void 0},o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!!n.bubbles,!!n.cancelable,n.detail),o}function o(e,t){void 0===t&&(t={}),y&&"function"==typeof y[e]&&y[e](JSON.stringify(t)),v&&v[e]&&"function"==typeof v[e].postMessage&&v[e].postMessage(t),w&&parent.postMessage({handler:e,params:t,type:"vk-connect",webFrameId:d,connectVersion:"1.6.0"},"*")}function r(e){f.push(e)}var p,s,a,u,l,f,d,c,b,y,v,w,A;e.exports=(p=function(){return(p=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppResizeWindow","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites"],f=[],d=null,c="undefined"!=typeof window,b=c&&window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.VKWebAppClose,y=c?window.AndroidBridge:void 0,v=b?window.webkit.messageHandlers:void 0,A=(w=c&&!y&&!v)?"message":"VKWebAppEvent",c&&(window.CustomEvent||(window.CustomEvent=(n.prototype=Event.prototype,n)),window.addEventListener(A,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],p=0,s=i.length;p<s;p++,r++)o[r]=i[p];return o}(f);if(w&&t[0]&&"data"in t[0]){var o=t[0].data,r=(o.webFrameId,o.connectVersion,i(o,["webFrameId","connectVersion"]));r.type&&"VKWebAppSettings"===r.type?d=r.frameId:n.forEach(function(e){e({detail:r})})}else n.forEach(function(e){e.apply(null,t)})})),{send:o,subscribe:r,sendPromise:(s=o,a=r,u=function(){var n={current:0,next:function(){return this.current+=1,this.current}},r={};return{add:function(e){var t=n.next();return r[t]=e,t},resolve:function(e,t,n){var o=r[e];o&&(n(t)?o.resolve(t):o.reject(t),r[e]=null)}}}(),a(function(e){if(e.detail&&e.detail.data){var t=e.detail.data,n=t.request_id,o=i(t,["request_id"]);n&&u.resolve(n,o,function(e){return!("error_type"in e)})}}),function(o,r){return new Promise(function(e,t){var n=u.add({resolve:e,reject:t});s(o,p(p({},r),{request_id:n}))})}),unsubscribe:function(e){var t=f.indexOf(e);-1<t&&f.splice(t,1)},isWebView:function(){return!(!y&&!v)},supports:function(e){return!(!y||"function"!=typeof y[e])||!(!v||!v[e]||"function"!=typeof v[e].postMessage)||!(v||y||!l.includes(e))}})}(t={exports:{}},t.exports),t.exports),o=n.sendPromise,r=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(n,["sendPromise"]);return e(e({},r),{send:o})});
